<!-- Keith Rausch -->

<!DOCTYPE html>

<html>

<head>
    <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
    <meta content="width=device-width,initial-scale=1.0" name="viewport">
    
    <title></title>
    <!-- cant figure out how to send favicon from python -->
    <!-- <link rel="shortcut icon" type="image/jpg" href="favicon.ico"/> -->

    <!-- Bootstrap CSS and Javascript-->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
    <!-- <link href="external/bootstrap-5.0.2-dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous"> -->
    <!-- <script src="external/bootstrap-5.0.2-dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script> -->


    <!-- css -->
    <link rel="stylesheet" href="css/index.css" type="text/css">

    <!-- other utils-->
    <script src="js/utils.js"></script>
</head>

<body>

    <div>
        <input class="border border-secondary rounded" id="uri" size="20" style="margin-bottom: 5px;" value="">
    </div>
    <div>
        <button class="btn btn-outline-primary" id="my_button">Button</button> <!-- TODO REMOVE ME. -->
    </div>
    <div id="date_time"></div>  <!-- TODO REMOVE ME. -->
    <div id="response_data"></div>  <!-- TODO REMOVE ME. -->
    <div id="interval_counter"></div>  <!-- TODO REMOVE ME. -->
    <div id="connection_loss_msg"></div>
    <q id="quote_body"></q>
    <div id="quote_author"></div>

    <script>

        debugging = false;

        window.onload = function () {
            // auto detect the websocket path
            // figure out if http or https
            // if the href is "https://ether.therausch.org/DEVICE/settings.html", then 
            // the websocket should connect to "wss://ether.therausch.org/DEVICE/""
            url = location.href;
            path = url.substring(url.indexOf('//') + 2, url.lastIndexOf('/') +
                1); // https://path/with/slashes/FILE_NAME_NOT_INCLUDED.html
            uri.value = location.protocol + '//' + path;

            // when done debugging, uncomment this
            if ( ! debugging) {
                hide_debugging_stuff();
            } 
        }

        function hide_debugging_stuff() {
            uri.style.display = "none";
            interval_counter.style.display = "none";
            my_button.style.display = "none";
            my_button.innerHTML = "Button"
        }

        function show_debugging_stuff() {
            uri.style.display = "inline";
            interval_counter.style.display = "inline";
            my_button.style.display = "inline";
            my_button.className = "btn btn-outline-primary";
            my_button.innerHTML = "Button";
        }


        function handle_server_response(response) {

            // clear connection loss message
            connection_loss_msg.innerHTML = ""

            // handle received info
            if ("config" in response) {
                // console.log(response["config"])
            }
            if ("current_quote_info" in response) {
                current_quote_info = response["current_quote_info"]
                if ("quote" in current_quote_info)
                    quote_body.innerHTML = current_quote_info["quote"]
                else
                    quote_body.innerHTML = "<error>"
                if ("who" in current_quote_info) 
                    quote_author.innerHTML = current_quote_info["who"]
                else
                    quote_author.innerHTML = "unknown"
            }
        }

        function handle_connection_loss() {
            connection_loss_msg.innerHTML = "CONNECTION LOSS"
            quote_body.innerHTML = ""
            quote_author.innerHTML = ""
        }

        my_button.onclick = function () {            
            date_time.innerHTML = "Button Clicked: " + get_date_time_string();

            query_server(uri.value+'/button', {}, handle_server_response);
        };

        // set up auto-query
        function run_on_interval() {
            interval_count += 1;
            interval_counter.innerHTML = "automatic query count: " + interval_count;
            query_server(uri.value+'/query', {}, handle_server_response, handle_connection_loss);
        }
        var interval_count = 0;
        var interval_id = setInterval(run_on_interval, 1000);

    </script>
                                                                                                                          

</body>



</html>