<!-- Keith Rausch -->

<!DOCTYPE html>

<html>

<head>
    <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
    <meta content="width=device-width,initial-scale=1.0" name="viewport">
    
    <title></title>
    <!-- cant figure out how to send favicon from python -->
    <!-- <link rel="shortcut icon" type="image/jpg" href="favicon.ico"/> -->

    <!-- Bootstrap CSS and Javascript-->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
    <!-- <link href="external/bootstrap-5.0.2-dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous"> -->
    <!-- <script src="external/bootstrap-5.0.2-dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script> -->


    <!-- css -->
    <link rel="stylesheet" href="css/index.css" type="text/css">
</head>

<body>

    <div>
        <input class="border border-secondary rounded" id="uri" size="20" style="margin-bottom: 5px;" value="">
    </div>
    <div>
        <button class="btn btn-outline-primary" id="my_button">Button</button>
    </div>
    <div id="date_time"></div>
    <div id="response_data"></div>
    <div id="interval_counter"></div>

    <script>
        window.onload = function () {
            // auto detect the websocket path
            // figure out if http or https
            // if the href is "https://ether.therausch.org/DEVICE/settings.html", then 
            // the websocket should connect to "wss://ether.therausch.org/DEVICE/""
            url = location.href;
            path = url.substring(url.indexOf('//') + 2, url.lastIndexOf('/') +
                1); // https://path/with/slashes/FILE_NAME_NOT_INCLUDED.html
            uri.value = location.protocol + '//' + path;

            // when done debugging, uncomment this
            debugging = true;
            if ( ! debugging) {
                hide_debugging_stuff();
            } 
        }

        function hide_debugging_stuff() {
            uri.style.display = "none";
            my_button.style.display = "none";
            my_button.innerHTML = "Button"
        }

        function show_debugging_stuff() {
            uri.style.display = "inline";
            my_button.style.display = "inline";
            my_button.className = "btn btn-outline-primary";
            my_button.innerHTML = "Button";
        }

        function get_date_time_string() {
            var currentdate = new Date(); 
            var datetime = currentdate.getDate() + "/"
            + (currentdate.getMonth()+1)  + "/" 
            + currentdate.getFullYear() + " @ "  
            + currentdate.getHours() + ":"  
            + currentdate.getMinutes() + ":" 
            + currentdate.getSeconds();
            return datetime;
        }

        async function send_post_to_server() {
                let response = await fetch(uri.value+'/thing', {
                    method: "POST",
                    headers: { "Content-type": "application/json" },
                    body: JSON.stringify({ field_number: 1, field_string: "2", field_bool: false, date_time: get_date_time_string() })
                    });
                let data = await response.text();

                // console.log(data);
                response_data.innerHTML = "got response: " + data;
            }

        my_button.onclick = function () {            
            date_time.innerHTML = "Button Clicked: " + get_date_time_string();

            send_post_to_server();
        };

        // set up auto-query
        function run_an_internal() {
            interval_count += 1;
            interval_counter.innerHTML = "automatic query count: " + interval_count;
            send_post_to_server();
        }
        var interval_count = 0;
        var interval_id = setInterval(run_an_internal, 1000);

    </script>
                                                                                                                          

</body>



</html>